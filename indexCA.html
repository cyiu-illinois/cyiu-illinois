<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="src/style.css" />
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js" integrity="sha512-iBAeBWWWFb8HqSBcrqcz98iIpuVH1la39dEYHtyQ/pGpeCQTQVvLJOWAuhv2Q7JSHp9k7hWA7sGxU3hHJe+tFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <title>Narrative Visualization for CS416</title>
  </head>
  <body onload="init()">
    <div style="display: flex; flex-direction: column; align-items: center;">
      <h2>Trends in COVID-19 death data</h2>
      <p id="text-content" style="text-align:left; width:800px; height:150px">
          The first case of COVID-19 hit Illinois in February 2020 and the first deaths were in March.  
          By May of that year, a first wave had peaked, which we will define for our purposes as a rise followed by a reduction 
          in number of deaths by at least 20% relative to the previous month and a drop of at least 250 in absolute terms.  
          The highest peak across the 3 years of data reported by the Washington Post occurred in December of 2020.
          The last peak occurred in January of 2022, after which deaths remained at a fairly constant level without peaking again afterwards.<br />
          While the early peak of Illinois was similar compared to the other 6 most populous states of the US, the patterns of highest and last peaks vary
          significantly.  Explore to see how each of these states fared.
        </p>
      <div class="controls">
          <a class="button" href="index2.html">&lt;</a> <a class="button disabled">&gt;</a>
      </div>
      <svg width="600" height="300"></svg>
      <div class="controls state-controls">
          <a class="button disabled">CA</a>
          <a class="button" href="indexTX.html">TX</a>
          <a class="button" href="indexFL.html">FL</a>
          <a class="button" href="indexNY.html">NY</a>
          <a class="button" href="indexPA.html">PA</a>
          <a class="button" href="index3.html">IL</a>
      </div>
    </div>


    <script>
          async function init() {
            const stateName = "California";

            const parseDate = d3.timeParse("%Y %b");
            const dateFormat = d3.timeFormat("%Y %b");
            var margin = 50, width = 600 - 2 * margin, height = 300 - 2 * margin;
            const data = await d3.csv('https://cyiu-illinois.github.io/data/CAMonthly.csv');

            var xScale = d3.scaleTime()
              .domain([parseDate("2020 Mar"), parseDate("2023 Feb")] )
              .range([ 0, width ]);
            var yScale = d3.scaleLinear().domain([0, 25000]).range([height ,0]);

              d3.select('svg').append('g')
                .attr('transform', 'translate(' + margin + ',' + margin + ')')
                .datum(data)
                .append("path")
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 4)
                .attr("d",
                  d3.line()
                    .x(function (d) {return xScale(parseDate(d.Text_Date))})
                    .y(function (d) {return yScale(d.Deaths_in_Month)})
                )

              d3.select('svg').append('g').attr('transform','translate(' + margin + ',' + margin + ')')
                .call(d3.axisLeft(yScale).tickValues(d3.range(0, 25001, 5000)));
              d3.select('svg').append('g').attr('transform','translate(' + margin + ',' + (height + margin) + ')')
                .call(d3.axisBottom(xScale).ticks(d3.timeMonth.every(6)).tickFormat(d3.timeFormat("%Y-%b")));

              const type = d3.annotationCalloutCircle;

              const annotations = [{
                note: {
                    label: "Aug 2020: 3784",
                    bgPadding: 2,
                    title: "First Peak"
                },
                x: 122,
                y: 220,
                className: "show-bg",
                dy: 45,
                dx: -1,
                subject: { radius: 10, radiusPadding: 0 }
             },{
                note: {
                  label: "Jan 2021: 15048",
                  bgPadding: 2,
                  title: "Highest Peak"
                },
                x: 193,
                y: 128,
                className: "show-bg",
                dy: -30,
                dx: 0,
                subject: { radius: 10, radiusPadding: 0 }
              },{
                note: {
                  label: "Nov 2022: 2947",
                  bgPadding: 2,
                  title: "Last Peak"
                },
                x: 507,
                y: 225,
                className: "show-bg",
                dy: -30,
                dx: 0,
                subject: { radius: 10, radiusPadding: 0 }
              }];
      
             const makeAnnotations = d3.annotation()
                .editMode(false)
                .notePadding(2)
                .type(type)
                .annotations(annotations)
      
             d3.select("svg")
                .append("g")
                .attr("class", "annotation-group")
                .call(makeAnnotations);

             d3.select("svg").append("text")
                 .attr("x", (width / 2) + margin)
                 .attr("y", (margin / 2))
                 .attr("text-anchor", "middle")
                 .style("font-size", "16px")
                 .style("text-decoration", "underline")
                 .text("COVID-19 Deaths in " + stateName + " per month");


        }


            
    </script>
  </body>
</html>
